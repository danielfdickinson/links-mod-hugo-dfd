{{- $ctx := . -}}
{{- $errorOnFail := (.Get 0) -}}
{{- $paramVer := slice -}}
{{- $skip := false -}}
{{- $pass := true -}}

{{- $result := partial "helpers/test-log.html" (dict "matchType" "eq" "actual" (string (isset .Page.Site.Params "hugoversion")) "expected" "true" "checkMessage" "site.Params.hugoversion exists" "skip" $skip) -}}
{{- $result.output -}}
{{- $pass = and $pass $result.pass (not $result.skip) -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "regexMatch" "actual" (string (site.Params.hugoVersion)) "expected" "[0-9]+\\.[0-9]+\\.[0-9]+" "checkMessage" "site.Params.hugoversion is of the form 0.0.0" "skip" $result.skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $result.skip) -}}

{{- if ne $result.skip true -}}
	{{- $paramVer = split (index .Page.Site.Params "hugoversion") "." -}}
{{- else -}}
	{{- $paramVer = (slice "0" "0" "0") -}}
{{- end -}}
{{- $paramMajor := int (index $paramVer 0) -}}
{{- $paramMinor := int (index $paramVer 1) -}}
{{- $paramPatch := int (index $paramVer 2) }}
{{- $result = partial "helpers/test-log.html" (dict "matchType" "sliceGt0" "actual" (slice $paramMajor $paramMinor $paramPatch) "expected" (slice "≥ 0" "≥ 0" "≥ 0") "checkMessage" "site.Params.hugoversion exists with (major, minor, patch)" "skip" $result.skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $result.skip) -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "sliceGt0" "actual" (slice $paramMajor $paramMinor $paramPatch) "expected" (slice "≥ 0" "> 0" "≥ 0") "checkMessage" "site.Params.hugoversion > 0.0.0" "skip" $result.skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $result.skip) -}}
{{- $skip = $result.skip -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "sliceEq" "actual" (slice $paramMajor $paramMinor $paramPatch) "expected" (apply (split hugo.Version ".") "int" ".") "checkMessage" "site.Params.hugoversion = hugo.Version" "skip" $skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $skip) -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "eq" "actual" (string (partial "helpers/functions/check-hugo-version.html" (dict "minMajor" $paramMajor "minMinor" $paramMinor "minPatch" (sub $paramPatch 1)))) "expected" "true" "checkMessage" (printf "hugo.Version %s ≥ %s.%s.%s minimum" hugo.Version (string $paramMajor) (string $paramMinor) (string (sub $paramPatch 1))) "skip" $skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $skip) -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "eq" "actual" (string (partial "helpers/functions/check-hugo-version.html" (dict "minMajor" $paramMajor "minMinor" (sub $paramMinor 1) "minPatch" (add $paramPatch 1)))) "expected" "true" "checkMessage" (printf "hugo.Version %s ≥ %s.%s.%s minimum" hugo.Version (string $paramMajor) (string (sub $paramMinor 1)) (string (add $paramPatch 1))) "skip" $skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $skip) -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "eq" "actual" (string (partial "helpers/functions/check-hugo-version.html" (dict "minMajor" $paramMajor "minMinor" $paramMinor "minPatch" (add $paramPatch 1)))) "expected" "false" "checkMessage" (printf "hugo.Version %s ≥ %s.%s.%s minimum" hugo.Version (string $paramMajor) (string $paramMinor) (string (add $paramPatch 1))) "skip" $skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $skip) -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "eq" "actual" (string (partial "helpers/functions/check-hugo-version.html" (dict "minMajor" $paramMajor "minMinor" (add $paramMinor 1) "minPatch" (sub $paramPatch 1)))) "expected" "false" "checkMessage" (printf "hugo.Version %s ≥ %s.%s.%s minimum" hugo.Version (string $paramMajor) (string (add $paramMinor 1)) (string (sub $paramPatch 1))) "skip" $skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $skip) -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "eq" "actual" (string (partial "helpers/functions/check-hugo-version.html" (dict "maxMajor" $paramMajor "maxMinor" (add $paramMinor 1) "maxPatch" (sub $paramPatch 1)))) "expected" "true" "checkMessage" (printf "hugo.Version %s ≤ %s.%s.%s maximum" hugo.Version (string $paramMajor) (string (add $paramMinor 1)) (string (sub $paramPatch 1))) "skip" $skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $skip) -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "eq" "actual" (string (partial "helpers/functions/check-hugo-version.html" (dict "maxMajor" $paramMajor "maxMinor" $paramMinor "maxPatch" (add $paramPatch 1)))) "expected" "true" "checkMessage" (printf "hugo.Version %s ≤ %s.%s.%s maximum" hugo.Version (string $paramMajor) (string $paramMinor) (string (add $paramPatch 1))) "skip" $skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $skip) -}}

{{- $result = partial "helpers/test-log.html" (dict "matchType" "eq" "actual" (string (partial "helpers/functions/check-hugo-version.html" (dict "maxMajor" $paramMajor "maxMinor" $paramMinor "maxPatch" (sub $paramPatch 1)))) "expected" "false" "checkMessage" (printf "hugo.Version %s ≤ %s.%s.%s maximum" hugo.Version (string $paramMajor) (string $paramMinor) (string (sub $paramPatch 1))) "skip" $skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $skip) -}}


{{- $result = partial "helpers/test-log.html" (dict "matchType" "eq" "actual" (string (partial "helpers/functions/check-hugo-version.html" (dict "maxMajor" $paramMajor "maxMinor" (sub $paramMinor 1) "maxPatch" (add $paramPatch 1)))) "expected" "false" "checkMessage" (printf "hugo.Version %s ≤ %s.%s.%s maximum" hugo.Version (string $paramMajor) (string (sub $paramMinor 1)) (string (add $paramPatch 1))) "skip" $skip) }}
{{ $result.output -}}
{{- $pass = and $pass $result.pass (not $skip) -}}

{{- if and (not $pass) (eq $errorOnFail true) -}}
	{{- errorf "FAIL: UNIT TEST SUMMARY: Check 'check-hugo-version'" -}}
{{- end -}}
